<!DOCTYPE html>
<html>
<head>
    <title>URLs checker</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <meta name="googlebot" content="noindex, nofollow">

    <style type="text/css">
        html,body{
            /*color: white;*/
            background: silver;
            height: 100%;
            width: 100%;
            margin: 0px;
        }
    iframe {
        width: 100%;
        height: 100%;
        background: white;
    }
    .col-10,
    .col-20,
    .col-80{
        position: relative;
        display: block;
        float: left;
    }
    .col-10{
        width:10%
    }
    .col-20{
        width:20%
    }
    .col-80{
        width:80%
    }
    .col-80{
        width:80%
    }
    .center{
        text-align: center;
    }
    
    
    #s{
        font-family: monospace;
        font-weight: bold;
        padding-left: 1em;
        
    }
    </style>
</head>

<body>
    
    <table style="width: 100%; height: 100%;">
        <tr height="0">
            <td colspan="3">
                URLS: <button id="loadUrls">LOAD</button>
                <button id="openAll">OPEN ALL IN TABS</button>
                <br>
                <textarea id="urls" id="" cols="100" rows="6" style="width:100%;" placeholder="One URL per line">
https://example.com
https://bing.com
                </textarea>
                
            </td>
        </tr>
        <tr height=0>
            <td class="center">
                <button id="prev">(&lt;) PREV</button>
                <button id="next">NEXT (&gt;)</button>
                <br><br>
                <div id="s">Click load</div>
            </td>
            <td>
                <input type="text" id="currUrl" size="100" style="width:100%;">
                <select id="select" size="10" style="width:100%;"></select>
            </td>
            <td class="center" width="0">
                <button id="go">GO (enter)</button>
                <button id="openExt">OPEN IN NEW (TAB)</button>
            </td>
        </tr>
        <tr>
            <td colspan="3">
                <iframe id="frame"></iframe>
            </td>
        </tr>
    </table>
    
    <script type='text/javascript'>
    //<![CDATA[

    var i = -1;
    var urlsArray = [];

    btns();
    
    
    document.body.onkeyup=function(e){
        console.log(e.keyCode);
        var ARROW_RIGHT = 39;
        var ARROW_LEFT = 37;
        var TAB = 9;
        var ENTER = 13;
        
        if(e.keyCode===ARROW_RIGHT){
            e.preventDefault();
            next.click();
        }
        if(e.keyCode===ARROW_LEFT){
            e.preventDefault();
            prev.click();
        }
        if(e.keyCode===TAB){
            e.preventDefault();
            openExt.click();
        }
        if(e.keyCode===ENTER){
            e.preventDefault();
            go.click();
        }
    };
    
    var popupSequence = false;
    //popup mode
    openAll.onclick = function() {
        urls.value = urls.value.trim();
        urlsArray = urls.value.split(/\n/);
        
        
        function nextPopup(){
            if(i<urlsArray.length-1){
                s.innerHTML = `Popup ${i+1} / ${urlsArray.length}`;
                
                setUrl(i);
                var popup = openPopup(urlsArray[++i], function(){
                    if(popupSequence) nextPopup();
                });
            }
            else{
                popupSequence = false;
                alert("FINISHED!"+ ` Popup ${i+1} / ${urlsArray.length}`);
                openAll.innerHTML = "OPEN ALL IN TABS";
            }
        }

        if(popupSequence===false){
            i = -1;
            popupSequence = true;
            loadUrls.click();
            nextPopup();
        }
        else{
            popupSequence = false;
            alert("OK I will stop!");
        }
        openAll.innerHTML = popupSequence ? "STOP OPENING TABS!":"OPEN ALL IN TABS";
        
    };
    
    function openPopup(url, onclose){
        var popup = window.open(url);
        if(!popup){
            alert("Please disable POPUP Blocker!");
        }
        else {
            //opened
            onclosepopup(popup, onclose);
        }
        
        function onclosepopup(popup, cb){
            var t = setInterval(function() {
                if (popup){
                    if (popup.closed) {
                        clearInterval(t);
                        cb();
                    }
                    else{
                        //still open
                    }
                }
                else{
                    clearInterval(t);
                    cb();
                }
            }, 1E3/10);    
        }
        return popup;
    }
    
    
    loadUrls.onclick = function() {
        i = -1;
        urls.value = urls.value.trim();
        urlsArray = urls.value.split(/\n/);
        s.innerHTML = `Loaded ${urlsArray.length} urls!`;
        currUrl.value = 'Click NEXT';
        console.log('loaded');
        
        poppulateSelect(select, urlsArray);

        btns();
    };
    
    select.onchange = function(){
        i = parseInt(select.value);
        setUrl(i);
    };
    
    go.onclick = function(){
        frame.src = currUrl.value;

        s.innerHTML = "New URL";
        currUrl.focus();
    };
    
    prev.onclick = function() {
        if (i > 0) {
            setUrl(--i);
        }

        btns();
    };
    
    next.onclick = function() {
        if (i < urlsArray.length) {
            setUrl(++i);
        }
        btns();
    };
    
    openExt.onclick = function(){
        window.open(urlsArray[i]);
    };

    function setUrl(i) {
        currUrl.value = urlsArray[i];
        frame.src = urlsArray[i];

        s.innerHTML = `${i+1} / ${urlsArray.length}`;
        currUrl.focus();
        select.value = i;
    }

    function btns() {
        prev.disabled = i < 1;
        next.disabled = i < urlsArray.length - 1 ? false : true;
        openExt.disabled = urlsArray.length < 1;
        currUrl.disabled = urlsArray.length < 1;
        
        if(urlsArray.length===0){
            currUrl.value = "No URL";
        }
    }
    
    
    function poppulateSelect(select, options){
        select.innerHTML = "";
        options.forEach(function(opt, i){
            select.appendChild(new Option(opt, i));
        });
    }
    </script>

</body>

</html>
